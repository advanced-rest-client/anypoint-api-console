<!doctype html>
<!--
@license
Copyright 2017 Mulesoft.
-->
<!--
This has to be run in a web server. Web component do not work with file:// scheme.
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <title>API console bundle inspector</title>
  <script src="bower_components/webcomponentsjs/webcomponents-loader.js"></script>
  <link rel="import" href="bower_components/app-layout/app-drawer/app-drawer.html">
  <link rel="import" href="bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
  <link rel="import" href="bower_components/app-layout/app-header/app-header.html">
  <link rel="import" href="bower_components/app-layout/app-header-layout/app-header-layout.html">
  <link rel="import" href="bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
  <link rel="import" href="bower_components/app-layout/app-toolbar/app-toolbar.html">

  <link rel="import" href="bower_components/shadycss/apply-shim.html">
  <link rel="import" href="bower_components/polymer/lib/elements/custom-style.html">
  <link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
  <link rel="import" href="bower_components/raml-aware/raml-aware.html">
  <link rel="import" href="bower_components/api-navigation/api-navigation.html">
  <link rel="import" href="bower_components/api-documentation/api-documentation.html">
  <link rel="import" href="bower_components/api-request-panel/api-request-panel.html">
  <link rel="import" href="bower_components/xhr-simple-request/xhr-simple-request.html">
  <link rel="import" href="bower_components/oauth-authorization/oauth-authorization.html">
  <link rel="import" href="bower_components/cryptojs-lib/cryptojs-lib.html">

  <link rel="import" href="bower_components/anypoint-styles/anypoint-theme.html">
  <!-- <script src="import-detection.js"></script> -->
  <style>
  html,
  body {
    margin: 0;
    font-family: "Open Sans", "DIN Pro", sans-serif;
    -webkit-font-smoothing: antialiased;
  }

  .api-selector {
    background-color: #fff;
  }

  [hidden] {
    display: none !important;
  }
  </style>
  <custom-style>
    <style is="custom-style">
    .drawer-content-wrapper {
      max-height: 100%;
      @apply --layout-vertical;
    }

    api-navigation {
      @apply --layout-flex-auto;
    }

    .main-content {
      margin-left: var(--api-console-main-content-margin-left, 24px);
      margin-right: var(--api-console-main-content-margin-right, 24px);

    }

    api-documentation {
      margin-right: 500px;
    }

    .tryit {
      position: fixed;
      top: 84px;
      right: 0px;
      width: 480px;
    }

    app-drawer-layout:not([narrow]) [drawer-toggle] {
      display: none;
    }

    app-toolbar {
      background-color: var(--api-console-toolbar-background-color, #000);
      color: var(--api-console-toolbar-color, #fff);
    }
    </style>
  </custom-style>
</head>
<body unresolved>
  <raml-aware scope="model" id="aware"></raml-aware>
  <xhr-simple-request></xhr-simple-request>
  <oauth1-authorization></oauth1-authorization>
  <oauth2-authorization></oauth2-authorization>
  <app-drawer-layout>
    <app-drawer slot="drawer">
      <div class="drawer-content-wrapper">
        <api-navigation aware="model" summary endpoints-opened></api-navigation>
      </div>
    </app-drawer>
    <app-header-layout>
      <app-header slot="header" fixed condenses effects="waterfall">
        <app-toolbar>
          <paper-icon-button icon="arc:menu" drawer-toggle></paper-icon-button>
          <div main-title>API console for Anypoint demo</div>
          <paper-dropdown-menu label="Select demo API" class="api-selector">
            <paper-listbox slot="dropdown-content" id="enpointsList">
              <paper-item data-src="demo-api.json">ARC demo API</paper-item>
              <paper-item data-src="cardconnect-rest-api.json">CardConnect REST API</paper-item>
              <paper-item data-src="exchange-xapi.json">Exchange Xapi</paper-item>
            </paper-listbox>
          </paper-dropdown-menu>
        </app-toolbar>
      </app-header>
      <div class="main-content">
        <api-documentation id="doc" aware="model" handle-navigation-events no-try-it></api-documentation>
        <div class="tryit" hidden>
          <api-request-panel aware="model"></api-request-panel>
        </div>
      </div>
    </app-header-layout>
  </app-drawer-layout>
  <script>
  var Demo = {};
  Demo.requestPanel = function() {
    return document.querySelector('api-request-panel');
  };
  Demo.requestPanelContainer = function() {
    return document.querySelector('.tryit');
  };
  Demo._apiChanged = function(e) {
    var file = e.target.selectedItem.dataset.src;
    Demo._loadFile(file);
  };
  Demo._loadFile = function(file) {
    var xhr = new XMLHttpRequest();
    xhr.addEventListener('load', (e) => {
      let data;
      try {
        data = JSON.parse(e.target.response);
      } catch (e) {
        window.alert('Unable to parse AMF model');
        return;
      }
      document.getElementById('aware').raml = data;
    });
    xhr.addEventListener('error', () => window.alert('Unable to load AMF model'));
    xhr.open('GET', './demo-apis/models/' + file);
    xhr.send();
  };
  Demo.init = function() {
    document.getElementById('enpointsList').selected = 0;
    document.getElementById('doc').scrollTarget = window;
  };
  Demo.runTryit = function(e) {
    var id = e.detail.id;
    Demo.requestPanel().selected = id;
    Demo.requestPanelContainer().removeAttribute('hidden');
  };
  Demo.navChanged = function(e) {
    if (e.detail.passive === true) {
      return;
    }
    if (e.detail.type !== 'method') {
      if (e.detail.passive === true) {
        return;
      }
      Demo.requestPanelContainer().setAttribute('hidden', true);
    } else {
      Demo.requestPanelContainer().removeAttribute('hidden');
    }
  };
  document.getElementById('enpointsList').addEventListener('selected-changed', Demo._apiChanged);
  window.addEventListener('WebComponentsReady', Demo.init);
  window.addEventListener('tryit-requested', Demo.runTryit);
  window.addEventListener('api-navigation-selection-changed', Demo.navChanged);
  </script>
</body>
</html>
